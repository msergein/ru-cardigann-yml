# ru-cardigann-yml

описание торрент-трекера [rutracker.org](https://rutracker.org/) в формате [Prowlarr Cardigann YML](https://wiki.servarr.com/prowlarr/cardigann-yml-definition). Данный формат используется в программах-индексаторах торрент-трекеров таких как [Сardigann](https://github.com/cardigann/cardigann), [Prowlarr](https://github.com/Prowlarr/Prowlarr), [Jackett](https://github.com/Jackett/Jackett).
Название раздач переформатируются, в формат понимаемый приложениями для автоматического скачивания раздач: [Radarr](https://github.com/Radarr/Radarr) (скачивание фильмов) и [Sonarr](https://github.com/Sonarr/Sonarr) (скачивание сериалов).

## Примеры

### Фильмы

раздача

 `Аватар / Avatar  (Джеймс Кэмерон / James Cameron)  [2009, США, Великобритания, фантастика, боевик, драма, приключения, BDRip 1080p]  [Special Edition Re-release Cut]  Dub  (CEE)  + Sub  (Rus, Eng)  + Original Eng`
 
переформатируется в:

`Avatar  (2009) [США, Великобритания, фантастика, боевик, драма, приключения, BDRip 1080p] [Special Edition Re-release Cut] Dub (CEE) + Sub (Rus, Eng) + Original Eng`

который понимает [Radarr](https://github.com/Radarr/Radarr)

### Сериалы:

`Игра престолов / Game of Thrones / Сезон: 1 / Серии: 1-10 (10) (Тимоти Ван Паттен, Брайан Кирк, Даниэль Минахан) [2011, США, Фэнтези, Драма, BDRip] Dub (РЕН) + Original`

после форматирования

`Game of Thrones  2011 s1e1-10 [США, Фэнтези, Драма, BDRip] Dub (РЕН) + Original`

Данный формат распознается [Sonarr](https://github.com/Sonarr/Sonarr)

### Русские фильмы и сериалы

Для русских фильмов и сериалов, когда не указывается английское название - тоже форматируется корректно:

1

`Брат (Алексей Балабанов) [1997, Драма, криминал, боевик, WEB-DLRip-AVC] + Sub Rus`

после обработки

`Брат  (1997) [Драма, криминал, боевик, WEB-DLRip-AVC] + Sub Rus`

2

`Эпидемия / Сезон: 2 / Серии: 1-8 из 8 + Фильм о фильме (Дмитрий Тюрин) [2022, драма, фантастика, триллер, WEBRip]`

после обработки

`Эпидемия  2022 s2e1-8 [драма, фантастика, триллер, WEBRip]`

## Собственный формат

Вы также можете задать собственный формат в настройках `default format`, `movie format` и `tv format`

**Примечание**: [Radarr](https://github.com/Radarr/Radarr) на текущий момент при поиске фильмов использует тип `search` вместо `movie` поэтому для него будет использоваться формат по умолчанию, а не тот который указан для фильмов. Это может поменяться после подтверждения данного [pull request'а](https://github.com/Radarr/Radarr/pull/8172)

Формат задается в таком виде:
`<#префикс#${value}#суффикс#>`
где value - распарсенное значение из раздачи, может быть следующие значения:
| название    | описание                                          | пример    |
|-------------|---------------------------------------------------|-----------|
| `title`     | заголовок, обычно на английском языке             | Avatar    |
| `alt_title` | альтернативный заголовок, обычно на русском языке | Аватар    |
| `year`      | год                       						            | 2009      |
| `s`         | номер сезона 						                          | 1         |
| `e_from`    | первая серия раздачи                              | 1         |
| `e_to`      | последняя серия раздачи                           | 10        |

Если `value` после парсинга не заполнено, то весь тег `<#...#>` убирается из итогового названия. 
Например формат

`<##${title}##><# (#${year}#)#><# s#${s}##><#e#${e_from}##><#-#${e_to}##> [`

если в названии не будет указаны сезон (`s`) и серии (`e_from`, `e_to`), то после обработки они не попадут в итоговое название

При описании формата надо учитывать, что регулярное выражение подменяет только строку до вхождения года, остальная часть остается без изменений, поэтому надо добавлять в конец формата ` [` чтобы не терять открывающуюся скобку которая была перед годом.
Регулярное выражение используемое для парсинга можно посмотреть в файле там где прописаны `re_replace`. 

Проверить выражение можно например здесь - https://regex101.com/, где укажите такие настройки:

- regex options: `gi`
- flavour: `.NET (C#)`
- function: `Substitution`
- Substitution: `ваш формат`
